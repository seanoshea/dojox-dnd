From 32baf681b8cfafad9b9534259db48e813641f694 Mon Sep 17 00:00:00 2001
From: Sean O' Shea <oshea.ie@gmail.com>
Date: Sun, 31 Jan 2010 22:36:21 -0800
Subject: [PATCH 3/3] Adding BoundingBoxController

---
 .project                                   |   11 ++++
 tests/.tmp_test_selector.html.30537~       |   52 ++++++++++++++++++++
 tests/.tmp_test_selector.html.45679~       |   40 ++++++++++++++++
 tests/.tmp_test_selector.html.67693~       |   40 ++++++++++++++++
 tests/.tmp_test_selector.html.70073~       |   52 ++++++++++++++++++++
 tests/robot/.tmp_test_selector.html.29769~ |   71 ++++++++++++++++++++++++++++
 tests/robot/.tmp_test_selector.html.36872~ |   71 ++++++++++++++++++++++++++++
 tests/robot/.tmp_test_selector.html.65190~ |   71 ++++++++++++++++++++++++++++
 8 files changed, 408 insertions(+), 0 deletions(-)
 create mode 100644 .project
 create mode 100644 tests/.tmp_test_selector.html.30537~
 create mode 100644 tests/.tmp_test_selector.html.45679~
 create mode 100644 tests/.tmp_test_selector.html.67693~
 create mode 100644 tests/.tmp_test_selector.html.70073~
 create mode 100644 tests/robot/.tmp_test_selector.html.29769~
 create mode 100644 tests/robot/.tmp_test_selector.html.36872~
 create mode 100644 tests/robot/.tmp_test_selector.html.65190~

diff --git a/.project b/.project
new file mode 100644
index 0000000..ea1c791
--- /dev/null
+++ b/.project
@@ -0,0 +1,11 @@
+<?xml version="1.0" encoding="UTF-8"?>
+<projectDescription>
+	<name>dojox-dnd</name>
+	<comment></comment>
+	<projects>
+	</projects>
+	<buildSpec>
+	</buildSpec>
+	<natures>
+	</natures>
+</projectDescription>
diff --git a/tests/.tmp_test_selector.html.30537~ b/tests/.tmp_test_selector.html.30537~
new file mode 100644
index 0000000..22ec00e
--- /dev/null
+++ b/tests/.tmp_test_selector.html.30537~
@@ -0,0 +1,52 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
+<html>
+	<head>
+		<title>Dojox DnD selector test</title>
+		<style type="text/css">
+			@import "../../../dojo/resources/dojo.css";
+			@import "../../../dojo/tests/dnd/dndDefault.css";
+			body { padding: 20px; }
+		</style>
+		<style title="text/css">
+			#boundingBox {
+				background:#999;
+				border:1px solid #2B2B2B;
+				opacity:0.6;
+				position:absolute;
+				z-index:19999;
+			}
+		</style>
+		<script type="text/javascript" src="../../../dojo/dojo.js" djConfig="isDebug: true"></script>
+		<script type="text/javascript">
+			dojo.require("dojox.dnd.Selector");
+			dojo.require("dojox.dnd.BoundingBoxController");
+			var albums, bb;
+			var init = function() {
+				albums = new dojox.dnd.Selector(dojo.byId("albums"));
+				dojo.connect(dojo.doc, "onkeydown", dojo.hitch(this, function(evt) {
+					// would usually use dojo.keys.UP_ARROW/dojo.keys.DOWN_ARROW
+					// but can't seem to get that working with doh. Instead, I'm using
+					// 'u' as an indicator for up and 'd' as an indicator for down.
+					if(evt.keyCode == 85) {
+						albums.shift(-1, evt.shiftKey);
+					}
+					if(evt.keyCode == 68) {
+						albums.shift(1, evt.shiftKey);
+					}
+				}));
+				bb = new dojox.dnd.BoundingBoxController({domNode: dojo.byId("boundingBox"), sources: [albums]});
+			};
+			dojo.addOnLoad(init);
+		</script>
+	</head>
+	<body>
+		<h1 id="header">Dojox DnD selector test</h1>
+		<p>Use the up/down arrows to iterate through the list after selecting one.</p>
+		<div id="albums" class="container">
+			<div id="blonde" class="dojoDndItem">Blonde on Blonde</div>
+			<div id="highway" class="dojoDndItem">Highway 61 Revisited</div>
+			<div id="tracks" class="dojoDndItem">Blood on the Tracks</div>
+		</div>
+		<div id="boundingBox" style="display:none;"></div>
+	</body>
+</html>
\ No newline at end of file
diff --git a/tests/.tmp_test_selector.html.45679~ b/tests/.tmp_test_selector.html.45679~
new file mode 100644
index 0000000..da10969
--- /dev/null
+++ b/tests/.tmp_test_selector.html.45679~
@@ -0,0 +1,40 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
+<html>
+	<head>
+		<title>Dojox DnD selector test</title>
+		<style type="text/css">
+			@import "../../../dojo/resources/dojo.css";
+			@import "../../../dojo/tests/dnd/dndDefault.css";
+			body { padding: 20px; }
+		</style>
+		<script type="text/javascript" src="../../../dojo/dojo.js" djConfig="isDebug: true"></script>
+		<script type="text/javascript">
+			dojo.require("dojox.dnd.Selector");
+			var albums;
+			var init = function() {
+				albums = new dojox.dnd.Selector(dojo.byId("albums"));
+				dojo.connect(dojo.doc, "onkeydown", dojo.hitch(this, function(evt) {
+					// would usually use dojo.keys.UP_ARROW/dojo.keys.DOWN_ARROW
+					// but can't seem to get that working with doh. Instead, I'm using
+					// 'u' as an indicator for up and 'd' as an indicator for down.
+					if(evt.keyCode == 85) {
+						albums.shift(-1, evt.shiftKey);
+					}
+					if(evt.keyCode == 68) {
+						albums.shift(1, evt.shiftKey);
+					}
+				}));
+			};
+			dojo.addOnLoad(init);
+		</script>
+	</head>
+	<body>
+		<h1 id="header">Dojox DnD selector test</h1>
+		<p>Use the up/down arrows to iterate through the list after selecting one.</p>
+		<div id="albums" class="container">
+			<div id="blonde" class="dojoDndItem">Blonde on Blonde</div>
+			<div id="highway" class="dojoDndItem">Highway 61 Revisited</div>
+			<div id="tracks" class="dojoDndItem">Blood on the Tracks</div>
+		</div>
+	</body>
+</html>
\ No newline at end of file
diff --git a/tests/.tmp_test_selector.html.67693~ b/tests/.tmp_test_selector.html.67693~
new file mode 100644
index 0000000..da10969
--- /dev/null
+++ b/tests/.tmp_test_selector.html.67693~
@@ -0,0 +1,40 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
+<html>
+	<head>
+		<title>Dojox DnD selector test</title>
+		<style type="text/css">
+			@import "../../../dojo/resources/dojo.css";
+			@import "../../../dojo/tests/dnd/dndDefault.css";
+			body { padding: 20px; }
+		</style>
+		<script type="text/javascript" src="../../../dojo/dojo.js" djConfig="isDebug: true"></script>
+		<script type="text/javascript">
+			dojo.require("dojox.dnd.Selector");
+			var albums;
+			var init = function() {
+				albums = new dojox.dnd.Selector(dojo.byId("albums"));
+				dojo.connect(dojo.doc, "onkeydown", dojo.hitch(this, function(evt) {
+					// would usually use dojo.keys.UP_ARROW/dojo.keys.DOWN_ARROW
+					// but can't seem to get that working with doh. Instead, I'm using
+					// 'u' as an indicator for up and 'd' as an indicator for down.
+					if(evt.keyCode == 85) {
+						albums.shift(-1, evt.shiftKey);
+					}
+					if(evt.keyCode == 68) {
+						albums.shift(1, evt.shiftKey);
+					}
+				}));
+			};
+			dojo.addOnLoad(init);
+		</script>
+	</head>
+	<body>
+		<h1 id="header">Dojox DnD selector test</h1>
+		<p>Use the up/down arrows to iterate through the list after selecting one.</p>
+		<div id="albums" class="container">
+			<div id="blonde" class="dojoDndItem">Blonde on Blonde</div>
+			<div id="highway" class="dojoDndItem">Highway 61 Revisited</div>
+			<div id="tracks" class="dojoDndItem">Blood on the Tracks</div>
+		</div>
+	</body>
+</html>
\ No newline at end of file
diff --git a/tests/.tmp_test_selector.html.70073~ b/tests/.tmp_test_selector.html.70073~
new file mode 100644
index 0000000..22ec00e
--- /dev/null
+++ b/tests/.tmp_test_selector.html.70073~
@@ -0,0 +1,52 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
+<html>
+	<head>
+		<title>Dojox DnD selector test</title>
+		<style type="text/css">
+			@import "../../../dojo/resources/dojo.css";
+			@import "../../../dojo/tests/dnd/dndDefault.css";
+			body { padding: 20px; }
+		</style>
+		<style title="text/css">
+			#boundingBox {
+				background:#999;
+				border:1px solid #2B2B2B;
+				opacity:0.6;
+				position:absolute;
+				z-index:19999;
+			}
+		</style>
+		<script type="text/javascript" src="../../../dojo/dojo.js" djConfig="isDebug: true"></script>
+		<script type="text/javascript">
+			dojo.require("dojox.dnd.Selector");
+			dojo.require("dojox.dnd.BoundingBoxController");
+			var albums, bb;
+			var init = function() {
+				albums = new dojox.dnd.Selector(dojo.byId("albums"));
+				dojo.connect(dojo.doc, "onkeydown", dojo.hitch(this, function(evt) {
+					// would usually use dojo.keys.UP_ARROW/dojo.keys.DOWN_ARROW
+					// but can't seem to get that working with doh. Instead, I'm using
+					// 'u' as an indicator for up and 'd' as an indicator for down.
+					if(evt.keyCode == 85) {
+						albums.shift(-1, evt.shiftKey);
+					}
+					if(evt.keyCode == 68) {
+						albums.shift(1, evt.shiftKey);
+					}
+				}));
+				bb = new dojox.dnd.BoundingBoxController({domNode: dojo.byId("boundingBox"), sources: [albums]});
+			};
+			dojo.addOnLoad(init);
+		</script>
+	</head>
+	<body>
+		<h1 id="header">Dojox DnD selector test</h1>
+		<p>Use the up/down arrows to iterate through the list after selecting one.</p>
+		<div id="albums" class="container">
+			<div id="blonde" class="dojoDndItem">Blonde on Blonde</div>
+			<div id="highway" class="dojoDndItem">Highway 61 Revisited</div>
+			<div id="tracks" class="dojoDndItem">Blood on the Tracks</div>
+		</div>
+		<div id="boundingBox" style="display:none;"></div>
+	</body>
+</html>
\ No newline at end of file
diff --git a/tests/robot/.tmp_test_selector.html.29769~ b/tests/robot/.tmp_test_selector.html.29769~
new file mode 100644
index 0000000..7b4fbc6
--- /dev/null
+++ b/tests/robot/.tmp_test_selector.html.29769~
@@ -0,0 +1,71 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
+<html>
+	<head>
+		<title>doh.robot dojox DnD Test</title>
+	
+		<style>
+			@import "../../../../util/doh/robot/robot.css";
+		</style>
+
+		<script type="text/javascript" src="../../../../dojo/dojo.js" djConfig="isDebug: true, parseOnLoad: true"></script>
+		<script type="text/javascript">
+			dojo.require("dojo.robotx");
+			
+			dojo.addOnLoad(function() {
+	
+				doh.robot.initRobot('../test_selector.html');
+	
+				doh.register('dojox.robot.DndSelectorTest', [
+					{
+						name: 'dojox dnd shift down test',
+						timeout: 10000,
+						runTest: function() {
+							var d = new doh.Deferred();
+							doh.robot.mouseMoveAt('blonde', 1000);
+							doh.robot.mouseClick({left:true, middle:false, right:false}, 100);
+							doh.robot.mouseClick({left:true, middle:false, right:false}, 100);
+							doh.robot.mouseMoveAt('header', 250);
+							doh.robot.mouseClick({left:true, middle:false, right:false}, 100);
+							doh.robot.typeKeys("d", 100);
+							doh.robot.sequence(function() {
+								dojo.query("> div", dojo.byId('albums')).forEach(function(item, index, array) {
+									if(index == 1) {
+										if(dojo.hasClass(item, "dojoDndItemSelected") && item.id == "highway") {
+											d.callback(true);		
+										} else {
+											d.errback(new Error("Second item in the album list was not selected"));		
+										}
+									} else {
+										doh.assertFalse(dojo.hasClass(item, "dojoDndItemSelected"));
+									}
+								});
+							}, 3000);
+							return d;
+						}
+					},
+					{
+						name: 'dojox dnd shift up test',
+						timeout: 10000,
+						runTest: function() {
+							var d = new doh.Deferred();
+							doh.robot.typeKeys("u", 100);
+							doh.robot.sequence(function() {
+								dojo.query("> div", dojo.byId('albums')).forEach(function(item, index, array) {
+									if(index == 0) {
+										if(dojo.hasClass(item, "dojoDndItemSelected") && item.id == "blonde") {
+											d.callback(true);		
+										} else {
+											d.errback(new Error("First item in the album list was not selected"));		
+										}
+									}
+								});
+							}, 1000);
+							return d;
+						}
+					}
+				]);
+				doh.run();
+			});
+		</script>
+	</head>
+</html>
\ No newline at end of file
diff --git a/tests/robot/.tmp_test_selector.html.36872~ b/tests/robot/.tmp_test_selector.html.36872~
new file mode 100644
index 0000000..7b4fbc6
--- /dev/null
+++ b/tests/robot/.tmp_test_selector.html.36872~
@@ -0,0 +1,71 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
+<html>
+	<head>
+		<title>doh.robot dojox DnD Test</title>
+	
+		<style>
+			@import "../../../../util/doh/robot/robot.css";
+		</style>
+
+		<script type="text/javascript" src="../../../../dojo/dojo.js" djConfig="isDebug: true, parseOnLoad: true"></script>
+		<script type="text/javascript">
+			dojo.require("dojo.robotx");
+			
+			dojo.addOnLoad(function() {
+	
+				doh.robot.initRobot('../test_selector.html');
+	
+				doh.register('dojox.robot.DndSelectorTest', [
+					{
+						name: 'dojox dnd shift down test',
+						timeout: 10000,
+						runTest: function() {
+							var d = new doh.Deferred();
+							doh.robot.mouseMoveAt('blonde', 1000);
+							doh.robot.mouseClick({left:true, middle:false, right:false}, 100);
+							doh.robot.mouseClick({left:true, middle:false, right:false}, 100);
+							doh.robot.mouseMoveAt('header', 250);
+							doh.robot.mouseClick({left:true, middle:false, right:false}, 100);
+							doh.robot.typeKeys("d", 100);
+							doh.robot.sequence(function() {
+								dojo.query("> div", dojo.byId('albums')).forEach(function(item, index, array) {
+									if(index == 1) {
+										if(dojo.hasClass(item, "dojoDndItemSelected") && item.id == "highway") {
+											d.callback(true);		
+										} else {
+											d.errback(new Error("Second item in the album list was not selected"));		
+										}
+									} else {
+										doh.assertFalse(dojo.hasClass(item, "dojoDndItemSelected"));
+									}
+								});
+							}, 3000);
+							return d;
+						}
+					},
+					{
+						name: 'dojox dnd shift up test',
+						timeout: 10000,
+						runTest: function() {
+							var d = new doh.Deferred();
+							doh.robot.typeKeys("u", 100);
+							doh.robot.sequence(function() {
+								dojo.query("> div", dojo.byId('albums')).forEach(function(item, index, array) {
+									if(index == 0) {
+										if(dojo.hasClass(item, "dojoDndItemSelected") && item.id == "blonde") {
+											d.callback(true);		
+										} else {
+											d.errback(new Error("First item in the album list was not selected"));		
+										}
+									}
+								});
+							}, 1000);
+							return d;
+						}
+					}
+				]);
+				doh.run();
+			});
+		</script>
+	</head>
+</html>
\ No newline at end of file
diff --git a/tests/robot/.tmp_test_selector.html.65190~ b/tests/robot/.tmp_test_selector.html.65190~
new file mode 100644
index 0000000..7b4fbc6
--- /dev/null
+++ b/tests/robot/.tmp_test_selector.html.65190~
@@ -0,0 +1,71 @@
+<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
+<html>
+	<head>
+		<title>doh.robot dojox DnD Test</title>
+	
+		<style>
+			@import "../../../../util/doh/robot/robot.css";
+		</style>
+
+		<script type="text/javascript" src="../../../../dojo/dojo.js" djConfig="isDebug: true, parseOnLoad: true"></script>
+		<script type="text/javascript">
+			dojo.require("dojo.robotx");
+			
+			dojo.addOnLoad(function() {
+	
+				doh.robot.initRobot('../test_selector.html');
+	
+				doh.register('dojox.robot.DndSelectorTest', [
+					{
+						name: 'dojox dnd shift down test',
+						timeout: 10000,
+						runTest: function() {
+							var d = new doh.Deferred();
+							doh.robot.mouseMoveAt('blonde', 1000);
+							doh.robot.mouseClick({left:true, middle:false, right:false}, 100);
+							doh.robot.mouseClick({left:true, middle:false, right:false}, 100);
+							doh.robot.mouseMoveAt('header', 250);
+							doh.robot.mouseClick({left:true, middle:false, right:false}, 100);
+							doh.robot.typeKeys("d", 100);
+							doh.robot.sequence(function() {
+								dojo.query("> div", dojo.byId('albums')).forEach(function(item, index, array) {
+									if(index == 1) {
+										if(dojo.hasClass(item, "dojoDndItemSelected") && item.id == "highway") {
+											d.callback(true);		
+										} else {
+											d.errback(new Error("Second item in the album list was not selected"));		
+										}
+									} else {
+										doh.assertFalse(dojo.hasClass(item, "dojoDndItemSelected"));
+									}
+								});
+							}, 3000);
+							return d;
+						}
+					},
+					{
+						name: 'dojox dnd shift up test',
+						timeout: 10000,
+						runTest: function() {
+							var d = new doh.Deferred();
+							doh.robot.typeKeys("u", 100);
+							doh.robot.sequence(function() {
+								dojo.query("> div", dojo.byId('albums')).forEach(function(item, index, array) {
+									if(index == 0) {
+										if(dojo.hasClass(item, "dojoDndItemSelected") && item.id == "blonde") {
+											d.callback(true);		
+										} else {
+											d.errback(new Error("First item in the album list was not selected"));		
+										}
+									}
+								});
+							}, 1000);
+							return d;
+						}
+					}
+				]);
+				doh.run();
+			});
+		</script>
+	</head>
+</html>
\ No newline at end of file
-- 
1.6.5.1

